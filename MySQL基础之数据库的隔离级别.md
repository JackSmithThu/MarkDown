---
title: MySQL基础之数据库的隔离级别
date: 2017-06-27 22:17:14
tags: [数据库,隔离级别]
categories: 技术
---

## 1.隔离级别

数据库的隔离级别有以下四种：

1. 读未提交
2. 读已提交
3. 可重复读
4. 串行化

## 2.数据库读取中的问题

隔离级别主要用来解决以下三个问题：

1. 脏读
2. 不可重复读
3. 幻读

### 2.1.脏读

假设 **A** 给 **B** 打 **5000** 块钱，修改了数据库当时还没有提交。此时 **B** 读取数据库中的自己账户的余额，以为自己收到了 **5000** 块钱。然而之后 **A** 并没有提交，而是回滚了该数据，所以最终 **B** 的账余额并没有增加。所以 **B** 读取到的是错误的信息，这就是**脏读**。

为了避免这种情况，需要把数据库的隔离级别设置为**读已提交**。其本质是：**如果一个事务要进行写操作，那么在其提交之前，其他事务不能读。**

### 2.2.不可重复读

假设一个账户中有 **5000** 块钱， **A** 和 **B** 同时从这个账户中取钱，当 A 查看余额时发现账户中有 **5000** 块钱，之后 **B** 取走了这 **5000** 块钱，当 **A** 再取钱的时候发现钱已经被取走了。也就是说，在同一事务中，**A** 对自己的账户进行的两次查询得到了不同的结果，这就是**不可重复读**。

不可重复读与脏读的区别在于，脏读读出的数据是**无效的未提交的信息**（脏读也称为**无效数据读出**）。而不可重复读两次读取的信息都是**有效的已提交的信息**，只不过在这两次读取期间数据被提交了而已。

为了避免这种情况，需要把数据库的隔离级别设置为**可重复读**。其本质是：**如果一个事务要进行读操作，那么在该事务结束之前，其他事务不能提交。**

### 2.3.幻读

假设 **A** 正在查询自己银行卡中的本月的消费记录，恰好此时 **B** 拿着 **A** 的信用卡刷了一笔钱。也就是说，在同一事务中，**A** 读到的两次消费记录不一致。新的结果中出现了**幻影行**，这就是**幻读**。

幻读与不可重复读的区别在于，不可重复读可以通过加锁来避免。然而，**你不可能给一条还未插入到数据库中的数据进行加锁**，因此幻读是无法通过加锁的这种机制来避免的。

为了避免这种情况，需要把数据库的隔离级别设置为**串行化**。这种手段使用的不是共享锁，而是**行版本控制**。其本质是：**一个事务执行时，不允许其他事务执行。**

## 3.数据库的默认隔离级别

**MySQL** 的默认隔离级别是可重复读.

大多数数据库如 **Sql Server** , **Oracle** 的默认级别是读已提交。

## 4.参考链接

[数据库事务隔离级别](http://blog.csdn.net/fg2006/article/details/6937413)

